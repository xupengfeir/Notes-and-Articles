# 电流环和转速环PI控制器参数整定分析

## 一、前置知识

幅频特性曲线分析一阶和二阶系统的性能时，分析对象都是开环传递函数。

### 1、一阶惯性环节性能分析

**1.1 一阶惯性环节**

设有一阶惯性环节（尾一多项式）

$$\frac{1}{Ts+1}$$

![20240125201611](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125201611.png)



**转折频率**：s前面系数的倒数，分母形式。

**截止频率定义**：从频域响应的角度分析，当保持输入信号的幅度不变，该笔那频率使输出信号将值最大值的0.707倍，即用频域特性表述即为幅值下降3dB的点处即为截止频率。**对应幅频特性-3dB的点和相频特性滞后45°(-45°)的点。**

**具体表现：** 截止频率以前，1rad/s时输出信号的保真度较高，基本能够实现跟随；在截止频率10rad/s处幅值降至0.707，相位滞后45°；100rad/s时，幅值降至0.173，相位滞后将近80°；1000rad/s基本已经没有响应了。证明截止频率对输入信号的响应性能能够提供直接指标。

![20240125201751](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125201751.png)

![20240125201821](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125201821.png)


**1.2 开环增益与截止频率对bode图的影响**

（1）更改转折频率

对于一阶惯性环节，可将系数T理解成采样时间，采样时间越小，采样频率越高，跟随频率也越高，这也说明高采样率的系统、高控制率的系统性能更好。更改系数T后，T减小，转折频率增大，截止频率右移增大；反之，同理。

![20240125201852](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125201852.png)

（2）更改开环增益

**1）增大一阶惯性环节的开环增益，会导致幅频曲线上移，导致幅频曲线与横轴0的焦点右移，截止频率wc增大。**

**2）增大一阶惯性环节的开环增益，不会对相频曲线产生任何影响。相频曲线只与s前的系数有关，只和转折频率有关。**

总结：

**1）截止频率对于一阶惯性系统而言，意味着信号响应性能的转折点，截止频率之前的点能够较好的跟随，但是截至频率之后，输入信号被大幅衰减。**

**2）Bode图可以对系统的响应特性进行一个直观的分析。**

**3）对于第一个转折点和最后一个转折点对应的转折频率，其对应系统相位的边界变化45°，其余转折点的转折频率对应相位变化90°。** 

## 2、二阶系统性能分析

电机控制的电流环实际上是一个二阶系统（典型一阶环节即为二阶系统）。

2.1 二阶系统传递函数

假设二阶系统传递函数：

$$G_{open}=\frac{1}{s(Ts+1)}$$

分析这个传递函数：

① 幅频特性初始斜率为-20dB，积分环节的作用；而后微分环节作用，斜率为-40dB。

②相频特性初始值-90°，积分环节使得系统天然滞后90°，相频曲线的最大值变为-180°。

③相位裕度（大于0时系统稳定）：截止频率处的相位加180°等于相位裕度，即截止频率处的相位离-180°的距离为正，则系统稳定。

（1）改变转折频率

s前的系数减小，转折频率增大，幅频特性的拐点滞后，相频特性右移。截止频率不变，快速性不变，相位裕度变大，系统稳定性增强。

![20240125202148](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125202148.png)


（2）改变开环增益

开环增益增加，截止频率右移变大，转折频率不变，相频特性曲线不变，系统响应加快，相位裕度减小，系统稳定性下降。

![20240125202207](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125202207.png)


总结：

1）截止频率决定了系统的响应速度；而相位裕度决定了系统的稳定性。

2）开环增益决定系统的截止频率，惯性环节s前的系数T决定转折频率，进而决定相位裕度。


## 二、PI参数整定

### 1、电流内环调节器设计

在矢量控制系统的电流环是对iq进行控制，控制的是定子电流，进而控制电机转矩。
电流内环的作用是在电机启动过程中能够以最大电流启动，同时在外部扰动下能够快速回复，加快动态跟踪响应速度，提高系统稳定性。电机控制系统电流环如图6所示。

![20240125202301](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125202301.png)

上图是电流环的传递函数流程图。电流内环的输入为电流信号的误差值，输出为参考电压，控制电动机转矩。第一个环节是PI调节器；第二个环节是延迟环节；第三个环节是PWM环节。

图中延迟环节：电流环PI控制器后存在一个延迟环节，控制器一拍延迟造成的延迟。采样完后，计算占空比，在下一个周期作用到逆变器上，系统特性这个一拍延迟必然存在。

电机传函近似处理为：

$$G_p(s)=\frac{i_q}{u_q}=\frac{1}{L_qs+R}$$

假设开关频率10kHz，由于开关频率较高，可以把延迟环节和PWM环节合并处理，记为td=Ts，Kpwm=1，可得流程图7：

![20240125202421](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125202421.png)

将电流环按照典型I型系统（二阶）来整定（比例微分环节（ $\tau_is+1$ ）对消了较大时间常数的惯性环节（  $\frac{L_q}{R}s+1$  ）），则开环传递函数为：

$$G_{open}=\frac{K_p(\tau_is+1)}{\tau_is}\frac{1}{R(\frac{L_q}{R}s+1)}\frac{1}{(1.5T_ss+1)}=\frac{K}{s(Ts+1)}$$

令 $\tau_i=\frac{L_q}{R}$, 得开环传递函数：

$$G_{open}=\frac{K_p}{R\tau_is(1.5T_ss+1)}=\frac{K}{s(Ts+1)}$$

对K和T求解：

$$K=\frac{K_p}{R\tau_i}=\frac{K_p}{Lq}$$

$$T=1.5T_s$$

一阶系统按  $KT=0.5$ 计算。

**典型I型系统稳定性分析：**

当对数幅频特性曲线的中频段以 **-20dB/dec** 的斜率穿越0dB线，且具有一定的宽度时，系统一定是稳定的。显然，要做到这一点，应该选择参数保证 $w_c<\frac{1}{T}$ ,因而 $w_cT<1,arctan(w_cT)<45°$ ，于是相角裕度为：

$$\gamma=180°-90°-arctan(w_cT)=90°-arctan(w_cT)>45°$$

表明典型I型系统能够满足稳定裕度的要求。

典型I型系统的开环传递函数，只有开怀增益K和时间常数T两个参数，时间常数T是控制对象本身固有的，唯一可变的是K。

当  $w_c<\frac{1}{T}$ ，开环对数频率特性利用对数坐标函数关系可知：

$$20lg(K)-0=20(lgw_c-lg1)=20lgw_c$$

$$\Rightarrow K=w_c$$

也即 $KT<1$ 。

上式表明，K值越大，截止频率 $w_c$ 也越大，系统响应越快，相角裕度 $\gamma=90-arctan(w_cT)$ 越小，这也说明了快速性和稳定性之间的矛盾。具体选择参数K时，需在二者性能指标之间取折中。

（1）动态跟随性能指标

典型一阶系统的闭环传递函数：

$$W(s)=\frac{W(s)}{1+W(s)}=\frac{\frac{K}{s(Ts+1)}}{1+\frac{K}{s(Ts+1)}}=\frac{\frac{K}{T}}{s^2+\frac{1}{T}s+\frac{K}{T}}$$

闭环传递函数的一般形式：

$$W(S)=\frac{w_n^2}{s^2+2\xi w_ns+w_n^2}$$

可得典型I型系统和闭环传递函数标准形式参数的关系：

$w_n=\sqrt{\frac{K}{T}}$ ,无阻尼自然震荡角；

$\xi =\frac{1}{2}\sqrt{\frac{1}{KT}}$ ，阻尼比或称衰减系数，且 $\xi w_n=\frac{1}{2T}$ .

因为 $KT<1$ ,所以 $\xi >\frac{1}{2}$ ，因此典型I型系统应取

$$0.5<\xi<1$$

![20240125204105](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125204105.png)

在上述表中，取折中的 $\xi=0.707,KT=0.5$ 参数关系就是西门子的“调节器最佳正定”方法的模最佳系统或二阶最佳系统。

### 2、转速外环调节器设计
设电机输入输出为转速（rpm/min），那么其传递函数如下图所示：

![20240125204212](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125204212.png)

1）转速环PI调节器：输出为iq的给定值。

2）电流内环等效传递函数：在研究转速外环时，将内环传函视作一阶惯性环节。一般按照阻尼比 $\xi=0.707$ 设计电流内环。**近似环节根据实际情况不同**。

![20240125204317](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125204317.png)

3）控制器一拍延迟造成的延迟环节：此环节来源于数字控制本身造成的控制延迟，因为控制器是在采样完后，才能计算占空比，并且必须在下一个采样周期，计算出的占空比才能在逆变器上起到效果。

4）转矩和电流的转换：纯增益环节。

（1）转速环开环传函及其特性
经计算可得，电流环开环传递函数 $\frac{1}{3T_ss+1}$ ，转速环的传递函数是一个典型的二型系统，对于二型系统，要想保证系统性能，中频段的斜率应为 **-20dB/dec**。对转速环的开环传函进行推导。

![20240125204508](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125204508.png)

注意：求PI的思路，先把一个符合响应效果预期效果的 $K_N,\tau_n$ 计算出来，再反过来推算Kp和Ki。

（2）转速环是一个三阶系统，传递函数框图如图所示。

![20240125204551](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125204551.png)

按照二阶系统的方法分析：

1）有两个纯积分环节，幅频特性初始斜率为-40dB，初始相位角-180°。

2）两个转折频率： $\frac{1}{0.00004}=25000rad/s$ 和 $\frac{1}{\tau_n}$ 。

设开环增益为1， $\tau_n=0.01$  ，得相幅特性曲线如下所示。第一个转折频率是微分环节的转折频率100rad/s，第二个转折频率为惯性环节的转折频率25000rad/s。微分环节会导致幅频特性曲线斜率减小，相频幅值上升，所以图中出现相频曲线凹凸的地方，这个凹凸的范围就是中频带宽。第一个转折点左侧是低频带，第二个转折点是高频带中间是中频带。

![20240125204709](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125204709.png)

**低频段斜率陡，增益高，表示系统的稳态精度好；高频段衰减越快，高频特性负分贝值越低，说明系统抗高频噪声干扰的能力越强；中频段以-20dB/dec的斜率穿越零分贝线，这一斜率占有足够的频带宽度，系统稳定性好。**

（3）转速环具体参数设计

中频带宽和截止频率的相位裕度是我们转速环设计的指标。截止频率处的相位裕度至少为45°，且越大越好。转速环带宽可以根据采样频率设定，比如采样时间为0.00001s，惯性环节的转折频率就是 $\frac{1}{0.00004}=25000rad/s$ 。lg25000=4.39。考虑到低频带宽也需要至少1.5宽度，那么我们的转速环带宽就可以设计为2.5即可。Lg25000-lgx=lg2.5，则微分环节处转折频率x=80，那么 $\tau_n=\frac{1}{80}=0.0125$ 。如果采样频率更高的话，可以相应的把中频带宽设计的更宽些。

![20240125204844](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125204844.png)

第一步：设计中频带宽。计算 $\tau_n$ 。在确定了 $\tau_n$ 之后，中频带宽也就确定了。

$$h=lg\frac{1}{4T_s}-lg\frac{1}{\tau_n}$$
$$w_c=\frac{1}{4T_s10^{\frac{h}{2}}}$$

由 $w_c$ 计算开环增益 $K_N$ 。设第一个转折点  $（lg\frac{1}{\tau_n}，x）$。

![20240125205154](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125205154.png)


（4）推导、与的关系

$K_N$ 、 $\tau_n$ 这两个变量能够单独决定系统的某个单一性能（中频段带宽和相位裕度），但是 $K_p,K_i$ 不行，因此可以着重从 $K_N$ 、 $\tau_n$ 这两个量分析。

![20240125205343](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125205343.png)

分析得到的结论：

1）增大Kp，不变Ki。 $\tau_n$ 增大， $K_N$ 不变； $\frac{1}{\tau_n}$ 减小；第一个转折频率左移；中频带宽变宽，同时截止频率 $w_n$ 变大（斜率-40dB段持续时间变短）。

2）减小Kp，不变Ki。 $\tau_n$ 减小， $K_N$ 不变； $\frac{1}{\tau_n}$ 增大；第一个转折频率右移；中频带宽变窄，同时截止频率 $w_n$ 变小（斜率-40dB段持续时间变长）。

3）不变Kp，增大Ki。 $\tau_n$ 减小， $K_N$ 增大； $\frac{1}{\tau_n}$ 增大；幅频向上移动，第一个转折频率右移；中频带宽变窄，截止频率变化 $w_n$ 取决于增大的幅度。（ $w_c$ ： $K_N$ 增大带来增加效应，转折频率右移带来减小效应）。

4）不变Kp，减小Ki。 $\tau_n$ 增大， $K_N$ 减小； $\frac{1}{\tau_n}$ 减小；幅频向下移动，第一个转折频率左移；中频带宽变宽，截止频率变化 $w_n$ 取决于减小的幅度。（  $w_c$ ： $K_N$ 增大带来增加效应，转折频率右移带来减小效应）。

小结：如果能够结合幅频相频特性曲线，结合截止频率、带宽、相位裕度三个指标去有方向的调节PI，这能够大大节省我们的时间。

**典型Ⅱ型系统性能指标与参数的关系分析：**

典型Ⅱ型系统的闭环系统结构图和开环对数频率特性如图12所示。

其中中频段也是以-20dB/dec的斜率穿越零分贝线。要实现上图相频特性曲线，显然要保证：

$\frac{1}{\tau}<w_c<\frac{1}{T}$ 或 $\tau>T$

开环传函有两个纯积分环节和一个微分环节，一个惯性环节，因此相角稳定裕度为

![20240125210025](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125210025.png)

可见， $\tau$ 比 $T$ 大多越多，系统稳定裕度越大。

在典型Ⅱ型开环传递函数中，时间常数T是控制对象固有的，因此，待定的参数有两个：K和 $\tau$ 。

为简化设计，引入一个新的变量h，表示**中频段的宽度**，h是一个决定控制系统动态品质关键参数，令

![20240125210204](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125210204.png)

由于T值一定，改变 $\tau$ 就相当于改变了中频宽h； $\tau$ 值确定后，再改变K相当于使特性曲线上下平移，从而改变了截止频率 $w_c$ 。因此在设计调节器时，选择频域参数h和， $w_c$  就相当于选择参数 $\tau$ 和K。

为降低工程设计中的工作量，采用振荡指标法中的闭环幅频特性峰值 $M_r$ 最小准则，找到h和 $w_c$ 的最佳组合。 在 $M_{rmin}$ 准则下， $w_c$ 和 $w_1$ 、 $w_2$ 之间有以下关系：

![20240125210441](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125210441.png)

![20240125210454](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125210454.png)

由上表可知，加大中频宽h，可以减小 $M_{rmin}$ ，从而降低系统超调量，但同时 $w_c$ 也将减小，使系统的快速性减弱。经验表明， $M_{rmin}$ 在1.2~1.5之间时，系统的动态性能较好，有时也允许 $M_{rmin}$ 达到1.8~2.0，所以h值可在3~10之间选择。h更大时，降低 $M_{rmin}$ 的效果就不显著了。

确定了h和 $w_c$ 之后，可以很容易计算 $\tau$ 和K。由h的定义可知

![20240125210722](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125210722.png)

$h<5$ 时，由于震荡次数增加，h再小，恢复时间 $t_s$ 反而拖长了。由此可知， $h=5$ 是较好的选择，这与跟随性能中调节时间 $t_s$ 最短的条件是一致。

典型I型系统的跟随性能超调小，但抗扰动性能稍差，而典型Ⅱ型系统抗扰性能比较好。

**控制工程对象的工程近似处理方法：**

实际控制系统的传递函数是多样的，往往不能简单地矫正成典型系统，这就需要做近似处理，以下讨论集中实际控制对象的工程近似处理方法。

（1）高频段小惯性环节的近似处理

当高频段有多个小时间常数 $T_1、T_2、T_3...$ 的小惯性环节时，可以等效地用一个小时间常数 $T$ 的惯性环节来代替。其等效时间常数T为：

$$T=T_1+T_2+T_3+\cdot\cdot\cdot$$

例如

![20240125211014](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125211014.png)

近似条件：

$$w_c\le \frac{1}{3\sqrt{T_1T_2}}$$

同理有三个小惯性环节时，近似条件：

$$w_c\le\frac{1}{3}\frac{1}{\sqrt{T_1T_2+T_1T_3+T_2T_3}}$$

（2）高阶系统的降阶近似处理

上述小惯性群的近似处理实际上是高阶系统降阶处理的一种特例。下面讨论更一般的情况，以三阶系统为例。

$$W(s)=\frac{K}{as^3+bs^2+cs+1}$$

式中，a，b，c都是正系数，且 $bc>a$ ，即系统是稳定的。若能忽略高次项，则可得近似的一阶系统的传递函数为

$$W(s)\approx\frac{K}{cs+1}$$

近似条件可以从频率特性导出：

![20240125211553](https://cdn.jsdelivr.net/gh/xupengfeir/Notes-and-Articles/Image/20240125211553.png)

（3）低频段大惯性环节的近似处理

当系统存在一个时间常数特别大的惯性环节 $\frac{1}{Ts+1}$ 时，可以近似地将其看成时积分环节 $\frac{1}{Ts}$ 。

$$\frac{1}{jwT+1}=\frac{1}{\sqrt{w^2T^2+1}}\angle-arctanwT$$

其幅值近似：

$$\frac{1}{\sqrt{w^2T^2+1}}\approx\frac{1}{wT}$$

近似条件： $(wT)^2>>1$ ，或者按照工程惯例,  $wT\ge\sqrt{10}$ ，取整数 $w_c\ge \frac{3}{T}$ 。此时设计的近似系统相位裕度要小于实际系统的相位裕度，使用近似的方法整定参数后，得到的实际系统的稳定性更强。因此这样的近似方法可行。

从稳态性能上看，这样近似处理相当于把系统的类型认为地提高了一级，如果原来是I型系统，近似处理后变成了Ⅱ型系统。

这种近似处理只适合用于分析动态性能，当考虑稳态精度时，仍采用原来的传递函数 $W(s)$ 即可。

**转速、电流环设计步骤（先内环后外环）：**
	
先从电流环开始，对其进行必要地近似处理后，根据电流环要求确定把它校正成典型I型系统，再按照动态性能指标要求确定电流环调节器的参数。电流环设计完成后，把电流环等效成转速环中地一个一阶惯性环节，近似处理后，再把转速环校正成典型Ⅱ型系统，按照动态性能要求确定转速环调节器的参数。

分析动态性能时，合理使用相幅频特性曲线（Bode图）对系统进行校正，重点关注截止频率，相位裕度等指标。

## 参考资料

[1]陈伯时. 电力拖动自动控制系统[M]. 机械工业出版社，2016.

